# PulsePal – Telegram Health Companion

PulsePal — это «умный» Telegram-ассистент, который превращает рутину по приёму лекарств, витаминов и БАДов в понятный и мотивирующий процесс. Бот помогает вести учёт препаратов, отслеживать запасы, настраивать напоминания и фиксировать прогресс без лишних приложений.

## Возможности

- **Онбординг и профиль.** Пользователь задаёт имя, часовой пояс (через геолокацию или вручную), выбирает «личность» бота и визуальную тему. Данные можно редактировать через `/profile`.
- **Карточки лекарств.** Через встроенный WebApp (`/add_med`) добавляются название, дозировка, форма, остатки и заметки. Бот предупреждает о возможных взаимодействиях и следит за запасами.
- **Напоминания.** `/set_reminder` поддерживает фиксированное время, расписание по дням недели, интервалы, события («после завтрака») и геолокацию. Есть быстрые кнопки времени и режим «назойливых» уведомлений.
- **Учёт доз и запасов.** Принятые дозы списываются автоматически, а при критическом остатке бот предлагает действия (найти аптеку, напомнить врачу).
- **Статистика и геймификация.** `/stats` строит графики соблюдения режима, `/achievements` — выдаёт значки за дисциплину. `/export` выгружает данные в JSON/CSV для врача.
- **Трекеры состояния.** `/symptom`, `/mood`, `/water` логируют симптомы, настроение и воду, формируя рекомендации.

## Технологии

- Python 3.11
- [python-telegram-bot 20.x](https://docs.python-telegram-bot.org/)
- FastAPI + Uvicorn для WebApp
- SQLAlchemy + PostgreSQL (Railway)
- APScheduler (через JobQueue) для фоновых задач
- HTML/CSS WebApp с темизацией под тему Telegram

## Запуск локально

```bash
git clone https://github.com/RomaFka28/telegram-bot.git
cd telegram-bot
python -m venv .venv && .venv\Scripts\activate
pip install -r requirements.txt
```

Создайте `.env`:

```
TELEGRAM_TOKEN=ваш_токен_бота
WEB_APP_URL=http://localhost:8000
DATABASE_URL=postgresql://postgres:password@localhost:5432/pulsepal
```

Инициализируйте БД (SQLAlchemy создаст таблицы автоматически):

```bash
python -m compileall .
python main.py
```

Параллельно запустите WebApp:

```bash
uvicorn web_server:app --host 0.0.0.0 --port 8000
```

## Деплой на Railway

1. Создайте проект и PostgreSQL-инстанс. Скопируйте `DATABASE_URL` (внутренний) и `DATABASE_PUBLIC_URL` (если нужны внешние подключения).
2. Создайте сервис **bot** из GitHub-репозитория. В переменных задайте:
   - `TELEGRAM_TOKEN`
   - `DATABASE_URL`
   - `WEB_APP_URL` (будет известен после запуска web-сервиса)
3. Создайте сервис **web** из того же репозитория с командой `uvicorn web_server:app --host 0.0.0.0 --port $PORT`, включите Public Networking и получите домен, например `https://web-production-XXXX.up.railway.app`.
4. Вернитесь к сервису бота, обновите `WEB_APP_URL` на полученный домен и redeploy.

## Структура

- `handlers/` — онбординг, профиль, напоминания, статистика и т.д.
- `services/` — бизнес-логика (пользователи, лекарства, напоминания, статистика, экспорт).
- `models.py` — SQLAlchemy ORM.
- `main.py` — точка входа, регистрация хендлеров и задач.
- `web/` — WebApp для добавления лекарств.

## Будущие улучшения

- Поддержка push-уведомлений через Telegram WebApp для молниеносных подтверждений.
- Сегрегация данных для «семейного режима» на основе разрешений (если понадобится вернуть).
- Встроенный выбор времени/дат через инлайн-интерфейсы Telegram.

## Имя и описание

- **Название бота:** `PulsePal` (в Telegram можно указать как «PulsePal | Health Buddy»).
- **Описание:** «PulsePal напоминает о лекарствах, считает запасы, мотивирует достижениями и помогает смотреть на здоровье системно. Всё внутри Telegram — без лишних приложений».
