# ChronicaCare – Telegram Health Companion

ChronicaCare — «умный» Telegram-ассистент, который помогает не забывать о лекарствах, следить за запасами и держать здоровье в фокусе без дополнительных приложений. С ботом всё происходит прямо в чате: от онбординга и карточек препаратов до напоминаний и статистики.

## Возможности

- **Онбординг и профиль.** Пользователь задаёт имя, часовой пояс (через геолокацию или город), выбирает «личность» бота. Профиль можно редактировать через `/profile`.
- **Карточки лекарств.** Встроенный WebApp (`/add_med`) собирает название, дозировку, форму, остатки и заметки. При необходимости можно прикрепить фото: отправьте упаковку боту, скопируйте `file_id` из ответа и вставьте в поле «ID фото».
- **Напоминания.** `/set_reminder` поддерживает фиксированное время, расписание по дням недели, интервалы, события («После завтрака +30») и геолокацию. Есть быстрые кнопки времени и режим «назойливых» сигналов.
- **Учёт доз и запасов.** После подтверждения приёма бот списывает дозу из остатка, а при критическом уровне предлагает найти аптеку или записать задачу «позвонить врачу».
- **Статистика и геймификация.** `/stats` строит графики соблюдения режима, `/achievements` выдаёт значки за дисциплину. `/export` выгружает данные в JSON/CSV для врача.
- **Трекеры состояния.** Команды `/symptom`, `/mood`, `/water` помогают вести дневник самочувствия.

## Технологии

- Python 3.11  
- [python-telegram-bot 20.x](https://docs.python-telegram-bot.org/)  
- SQLAlchemy + PostgreSQL (Railway)  
- APScheduler / JobQueue для фоновых задач  
- FastAPI + Uvicorn для WebApp  

## Локальный запуск

```bash
git clone https://github.com/RomaFka28/telegram-bot.git
cd telegram-bot
python -m venv .venv && .venv\Scripts\activate
pip install -r requirements.txt
```

Создайте `.env`:

```
TELEGRAM_TOKEN=ваш_токен
WEB_APP_URL=http://localhost:8000
DATABASE_URL=postgresql://postgres:password@localhost:5432/chronica
```

Далее:

```bash
python -m compileall .
python main.py
```

Отдельно поднимите WebApp:

```bash
uvicorn web_server:app --host 0.0.0.0 --port 8000
```

## Деплой на Railway

1. Создайте PostgreSQL-инстанс и сохраните `DATABASE_URL`.
2. Поднимите сервис **bot** из GitHub-репозитория. Задайте переменные:
   - `TELEGRAM_TOKEN`
   - `DATABASE_URL`
   - `WEB_APP_URL` (добавим после запуска web-сервиса)
3. Поднимите сервис **web** с командой `uvicorn web_server:app --host 0.0.0.0 --port $PORT`, включите Public Networking и получите домен вида `https://web-production-xxxx.up.railway.app`.
4. В сервисе бота обновите `WEB_APP_URL`, сделайте redeploy.

## Структура

- `main.py` — точка входа, регистрация обработчиков и job queue.
- `handlers/` — бизнес-сценарии (онбординг, профиль, лекарства, напоминания, статистика, lifestyle).
- `services/` — работа с БД и доменной логикой (пользователи, препараты, напоминания, экспорт).
- `models.py` — ORM-модели SQLAlchemy.
- `web/` — фронтенд WebApp для добавления лекарств.

## О боте

- **Название:** ChronicaCare  
- **Краткое описание:** «ChronicaCare напоминает о лекарствах, следит за запасами и мотивирует прогресс прямо в Telegram. Нажми /start — и настроимся на твой ритм».
