# ChronicaCare – Telegram Health Companion

ChronicaCare — «умный» Telegram-ассистент, который напоминает о лекарствах, следит за запасами и помогает вести дневники самочувствия прямо в чате. Никаких дополнительных приложений: всё — от онбординга до статистики — живёт в одном диалоге.

## Основные возможности

- **Онбординг и профиль.** Пользователь задаёт имя, часовой пояс (геолокацией или названием города) и выбирает подходящий стиль общения. Профиль можно редактировать через `/profile`.
- **Карточки лекарств.** Встроенный WebApp (`/add_med`) собирает название, дозировку, форму, остатки и заметки. Фото можно прикрепить: отправьте боту снимок упаковки — он пришлёт `file_id`, который вставляется в форму.
- **Редактирование остатков.** В `/meds` у каждого препарата есть кнопки «История», «Архивировать/вернуть» и «Изменить остаток». Можно ввести новое количество или прибавить/убавить значение (`+10`, `50`). Для быстрой корректировки есть команды `/restock <id> <кол-во>` и `/set_stock <id> <значение>`.
- **Напоминания.** `/set_reminder` поддерживает фиксированное время, расписание по дням недели, интервальные напоминания и события вроде «После завтрака +30». Есть быстрые кнопки времени и режим “назойливых” уведомлений.
- **Учёт доз и запасов.** После подтверждения приёма бот списывает дозу. Когда остаток подходит к концу, ChronicaCare предлагает найти аптеку или сразу открыть кнопку «Изменить остаток».
- **Статистика и экспорт.** `/stats` строит графики дисциплины, `/achievements` выдаёт значки, `/export` выгружает JSON/CSV для врача.
- **Трекеры состояния.** `/symptom`, `/mood`, `/water` помогают фиксировать симптомы, настроение и воду.

## Технологии

- Python 3.11  
- [python-telegram-bot 20.x](https://docs.python-telegram-bot.org/)  
- FastAPI + Uvicorn для WebApp  
- SQLAlchemy + PostgreSQL (Railway)  
- APScheduler / JobQueue для фоновых задач  

## Локальный запуск

```bash
git clone https://github.com/RomaFka28/telegram-bot.git
cd telegram-bot
python -m venv .venv && .venv\Scripts\activate
pip install -r requirements.txt
```

Создайте `.env`:

```
TELEGRAM_TOKEN=ваш_токен
WEB_APP_URL=http://localhost:8000
DATABASE_URL=postgresql://postgres:password@localhost:5432/chronica
```

Далее:

```bash
python -m compileall .
python main.py
```

WebApp:

```bash
uvicorn web_server:app --host 0.0.0.0 --port 8000
```

## Деплой на Railway

1. Создайте PostgreSQL-инстанс и сохраните `DATABASE_URL`.
2. Запустите сервис **bot** из GitHub-репозитория. Переменные: `TELEGRAM_TOKEN`, `DATABASE_URL`, временно `WEB_APP_URL`.
3. Запустите сервис **web** (команда `uvicorn web_server:app --host 0.0.0.0 --port $PORT`), включите Public Networking и возьмите домен вида `https://web-production-xxxx.up.railway.app`.
4. Вернитесь к сервису бота, обновите `WEB_APP_URL` на полученный домен и сделайте redeploy.

## Структура проекта

- `main.py` — регистрация хендлеров, JobQueue, фоновые задачи.
- `handlers/` — онбординг, профиль, лекарства, напоминания, статистика, трекеры, сообщения.
- `services/` — логика работы с БД (пользователи, препараты, напоминания, экспорт, статистика).
- `models.py` — ORM-модели SQLAlchemy.
- `web/` — фронтенд WebApp.

## Имя и описание бота

- **Название:** ChronicaCare  
- **Краткое описание:** «ChronicaCare напоминает о лекарствах, следит за запасами и ведёт твой ритм здоровья прямо в Telegram. Нажми /start, чтобы настроиться».
